#!/bin/zsh

echo "Checking for existing SSH keys"
if ! [[ -e ~/.ssh/id_rsa.pub ]]; then

  echo "Generating a new SSH key"
  ssh-keygen -t rsa -b 4096 -C ${1:-'ethanabrooks@gmail.com'}

  echo "Adding your SSH key to the ssh-agent"
  eval "$(ssh-agent -s)"
  ssh-add ~/.ssh/id_rsa
fi

id_rsa=$(cat ~/.ssh/id_rsa.pub)
ssh $1 "echo $id_rsa >> $HOME/.ssh/authorized_keys"
